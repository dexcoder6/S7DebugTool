<Window x:Class="S7DebugTool.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="S7协议调试工具" Height="800" Width="1400"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>
        
        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>
        
        <!-- 连接配置区域 -->
        <GroupBox Grid.Row="0" Header="连接配置" Margin="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="IP地址:" VerticalAlignment="Center" Margin="5"/>
                <TextBox Grid.Column="1" Name="txtIpAddress" Text="{Binding IpAddress}" 
                         VerticalAlignment="Center" Margin="5"/>
                
                <TextBlock Grid.Column="2" Text="机架号:" VerticalAlignment="Center" Margin="5"/>
                <TextBox Grid.Column="3" Name="txtRack" Text="{Binding Rack}" 
                         VerticalAlignment="Center" Margin="5"/>
                
                <TextBlock Grid.Column="4" Text="插槽号:" VerticalAlignment="Center" Margin="5"/>
                <TextBox Grid.Column="5" Name="txtSlot" Text="{Binding Slot}" 
                         VerticalAlignment="Center" Margin="5"/>
                
                <StackPanel Grid.Column="6" Orientation="Horizontal">
                    <Button Content="连接" Command="{Binding ConnectCommand}" 
                            Style="{StaticResource ActionButton}"
                            IsEnabled="{Binding CanConnect}"/>
                    <Button Content="断开" Command="{Binding DisconnectCommand}" 
                            Style="{StaticResource ActionButton}"
                            IsEnabled="{Binding IsConnected}"/>
                </StackPanel>
                
                <TextBlock Grid.Column="7" VerticalAlignment="Center" Margin="10,0">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                    <Setter Property="Text" Value="已连接"/>
                                    <Setter Property="Foreground" Value="Green"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsConnected}" Value="False">
                                    <Setter Property="Text" Value="未连接"/>
                                    <Setter Property="Foreground" Value="Red"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </GroupBox>
        
        <!-- 主操作区域 -->
        <TabControl Grid.Row="1" Margin="10,0,10,10">
            <!-- 单个数据读写标签页 -->
            <TabItem Header="数据类型读写">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- 读取数据区域 -->
                    <GroupBox Grid.Column="0" Header="读取数据" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="内存区域:" VerticalAlignment="Center" Margin="5"/>
                                <ComboBox Grid.Column="1" Name="cmbReadArea" 
                                         SelectedValue="{Binding ReadAreaType}"
                                         SelectedValuePath="Content" Margin="5">
                                    <ComboBoxItem Content="数据块(DB)"/>
                                    <ComboBoxItem Content="输入(I)"/>
                                    <ComboBoxItem Content="输出(Q)"/>
                                    <ComboBoxItem Content="标志位(M)"/>
                                </ComboBox>
                            </Grid>
                            
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="DB块号:" VerticalAlignment="Center" Margin="5"
                                          Visibility="{Binding ShowDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBox Grid.Column="1" Text="{Binding ReadDbNumber}" Margin="5"
                                        Visibility="{Binding ShowDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                            
                            <Grid Grid.Row="2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="起始地址:" VerticalAlignment="Center" Margin="5"/>
                                <TextBox Grid.Column="1" Text="{Binding ReadStartAddress}" Margin="5"/>
                                
                                <TextBlock Grid.Column="2" Text="长度(字节):" VerticalAlignment="Center" Margin="5"/>
                                <TextBox Grid.Column="3" Text="{Binding ReadLength}" Margin="5"/>
                            </Grid>
                            
                            <Grid Grid.Row="3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="数据类型:" VerticalAlignment="Center" Margin="5"/>
                                <ComboBox Grid.Column="1" 
                                         SelectedValue="{Binding ReadDataType}"
                                         SelectedValuePath="Content" Margin="5">
                                    <ComboBoxItem Content="Byte"/>
                                    <ComboBoxItem Content="Bool"/>
                                    <ComboBoxItem Content="Word"/>
                                    <ComboBoxItem Content="DWord"/>
                                    <ComboBoxItem Content="Int"/>
                                    <ComboBoxItem Content="DInt"/>
                                    <ComboBoxItem Content="Real"/>
                                    <ComboBoxItem Content="LReal"/>
                                    <ComboBoxItem Content="String"/>
                                    <ComboBoxItem Content="DateTime"/>
                                </ComboBox>
                                
                                <TextBlock Grid.Column="2" Text="位地址:" VerticalAlignment="Center" Margin="5"
                                          Visibility="{Binding ShowBitAddress, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBox Grid.Column="3" Text="{Binding ReadBitAddress}" Margin="5"
                                        Visibility="{Binding ShowBitAddress, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                            
                            <Button Grid.Row="4" Content="读取" Command="{Binding ReadCommand}" 
                                   HorizontalAlignment="Left" Style="{StaticResource ActionButton}"
                                   IsEnabled="{Binding IsConnected}"/>
                            
                            <GroupBox Grid.Row="5" Header="读取结果" Margin="5">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                                        <RadioButton Content="十六进制" IsChecked="{Binding ShowHex}" Margin="5,0"/>
                                        <RadioButton Content="十进制" IsChecked="{Binding ShowDecimal}" Margin="15,0,5,0"/>
                                        <RadioButton Content="ASCII" IsChecked="{Binding ShowAscii}" Margin="15,0,5,0"/>
                                    </StackPanel>
                                    
                                    <TextBox Grid.Row="1" Name="txtReadResult" 
                                            Text="{Binding ReadResult}" 
                                            IsReadOnly="True" 
                                            TextWrapping="Wrap"
                                            VerticalScrollBarVisibility="Auto"
                                            HorizontalScrollBarVisibility="Disabled"
                                            FontFamily="Consolas"
                                            FontSize="12"/>
                                </Grid>
                            </GroupBox>
                        </Grid>
                    </GroupBox>
                    
                    <!-- 写入数据区域 -->
                    <GroupBox Grid.Column="1" Header="写入数据" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="内存区域:" VerticalAlignment="Center" Margin="5"/>
                                <ComboBox Grid.Column="1" Name="cmbWriteArea" 
                                         SelectedValue="{Binding WriteAreaType}"
                                         SelectedValuePath="Content" Margin="5">
                                    <ComboBoxItem Content="数据块(DB)"/>
                                    <ComboBoxItem Content="输入(I)"/>
                                    <ComboBoxItem Content="输出(Q)"/>
                                    <ComboBoxItem Content="标志位(M)"/>
                                </ComboBox>
                            </Grid>
                            
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="DB块号:" VerticalAlignment="Center" Margin="5"
                                          Visibility="{Binding ShowWriteDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBox Grid.Column="1" Text="{Binding WriteDbNumber}" Margin="5"
                                        Visibility="{Binding ShowWriteDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                            
                            <Grid Grid.Row="2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="起始地址:" VerticalAlignment="Center" Margin="5"/>
                                <TextBox Grid.Column="1" Text="{Binding WriteStartAddress}" Margin="5"/>
                                
                                <TextBlock Grid.Column="2" Text="位地址:" VerticalAlignment="Center" Margin="5"
                                          Visibility="{Binding ShowWriteBitAddress, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBox Grid.Column="3" Text="{Binding WriteBitAddress}" Margin="5"
                                        Visibility="{Binding ShowWriteBitAddress, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                            
                            <Grid Grid.Row="3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="数据类型:" VerticalAlignment="Center" Margin="5"/>
                                <ComboBox Grid.Column="1" 
                                         SelectedValue="{Binding WriteDataType}"
                                         SelectedValuePath="Content" Margin="5">
                                    <ComboBoxItem Content="Byte"/>
                                    <ComboBoxItem Content="Bool"/>
                                    <ComboBoxItem Content="Word"/>
                                    <ComboBoxItem Content="DWord"/>
                                    <ComboBoxItem Content="Int"/>
                                    <ComboBoxItem Content="DInt"/>
                                    <ComboBoxItem Content="Real"/>
                                    <ComboBoxItem Content="LReal"/>
                                    <ComboBoxItem Content="String"/>
                                    <ComboBoxItem Content="DateTime"/>
                                </ComboBox>
                            </Grid>
                            
                            <GroupBox Grid.Row="4" Header="写入值" Margin="5">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Text="{Binding WriteDataHint}" 
                                              Foreground="Gray" Margin="5,0,5,5"/>
                                    
                                    <TextBox Grid.Row="1" Name="txtWriteData" 
                                            Text="{Binding WriteData}" 
                                            AcceptsReturn="True"
                                            TextWrapping="Wrap"
                                            VerticalScrollBarVisibility="Auto"
                                            HorizontalScrollBarVisibility="Disabled"
                                            FontFamily="Consolas"
                                            FontSize="12"/>
                                </Grid>
                            </GroupBox>
                            
                            <Button Grid.Row="5" Content="写入" Command="{Binding WriteCommand}" 
                                   HorizontalAlignment="Left" Style="{StaticResource ActionButton}"
                                   IsEnabled="{Binding IsConnected}"/>
                        </Grid>
                    </GroupBox>
                </Grid>
            </TabItem>
            
            <!-- 批量字节读写标签页 -->
            <TabItem Header="批量字节读写">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- 批量读取区域 -->
                    <GroupBox Grid.Column="0" Header="批量读取" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="内存区域:" VerticalAlignment="Center" Margin="5"/>
                                <ComboBox Grid.Column="1" 
                                         SelectedValue="{Binding BatchReadAreaType}"
                                         SelectedValuePath="Content" Margin="5">
                                    <ComboBoxItem Content="数据块(DB)"/>
                                    <ComboBoxItem Content="输入(I)"/>
                                    <ComboBoxItem Content="输出(Q)"/>
                                    <ComboBoxItem Content="标志位(M)"/>
                                </ComboBox>
                            </Grid>
                            
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="DB块号:" VerticalAlignment="Center" Margin="5"
                                          Visibility="{Binding ShowBatchDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBox Grid.Column="1" Text="{Binding BatchReadDbNumber}" Margin="5"
                                        Visibility="{Binding ShowBatchDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                            
                            <Grid Grid.Row="2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="起始地址:" VerticalAlignment="Center" Margin="5"/>
                                <TextBox Grid.Column="1" Text="{Binding BatchReadStartAddress}" Margin="5"/>
                                
                                <TextBlock Grid.Column="2" Text="长度(字节):" VerticalAlignment="Center" Margin="5"/>
                                <TextBox Grid.Column="3" Text="{Binding BatchReadLength}" Margin="5"/>
                            </Grid>
                            
                            <Grid Grid.Row="3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Button Content="批量读取" Command="{Binding BatchReadCommand}" 
                                       Style="{StaticResource ActionButton}"
                                       IsEnabled="{Binding IsConnected}"/>
                                
                                <Button Grid.Column="1" Content="清空" Command="{Binding ClearBatchReadCommand}" 
                                       Style="{StaticResource ActionButton}"/>
                            </Grid>
                            
                            <GroupBox Grid.Row="4" Header="读取结果" Margin="5">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                                        <RadioButton Content="十六进制" IsChecked="{Binding BatchShowHex}" Margin="5,0"/>
                                        <RadioButton Content="十进制" IsChecked="{Binding BatchShowDecimal}" Margin="15,0,5,0"/>
                                        <RadioButton Content="ASCII" IsChecked="{Binding BatchShowAscii}" Margin="15,0,5,0"/>
                                        <CheckBox Content="显示地址" IsChecked="{Binding ShowAddress}" Margin="20,0,5,0"/>
                                    </StackPanel>
                                    
                                    <TextBox Grid.Row="1" 
                                            Text="{Binding BatchReadResult}" 
                                            IsReadOnly="True" 
                                            TextWrapping="Wrap"
                                            VerticalScrollBarVisibility="Auto"
                                            HorizontalScrollBarVisibility="Disabled"
                                            FontFamily="Consolas"
                                            FontSize="12"/>
                                </Grid>
                            </GroupBox>
                        </Grid>
                    </GroupBox>
                    
                    <!-- 批量写入区域 -->
                    <GroupBox Grid.Column="1" Header="批量写入" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="内存区域:" VerticalAlignment="Center" Margin="5"/>
                                <ComboBox Grid.Column="1" 
                                         SelectedValue="{Binding BatchWriteAreaType}"
                                         SelectedValuePath="Content" Margin="5">
                                    <ComboBoxItem Content="数据块(DB)"/>
                                    <ComboBoxItem Content="输入(I)"/>
                                    <ComboBoxItem Content="输出(Q)"/>
                                    <ComboBoxItem Content="标志位(M)"/>
                                </ComboBox>
                            </Grid>
                            
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="DB块号:" VerticalAlignment="Center" Margin="5"
                                          Visibility="{Binding ShowBatchWriteDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBox Grid.Column="1" Text="{Binding BatchWriteDbNumber}" Margin="5"
                                        Visibility="{Binding ShowBatchWriteDbNumber, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                            
                            <Grid Grid.Row="2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="起始地址:" VerticalAlignment="Center" Margin="5"/>
                                <TextBox Grid.Column="1" Text="{Binding BatchWriteStartAddress}" Margin="5"/>
                            </Grid>
                            
                            <GroupBox Grid.Row="3" Header="写入数据 (十六进制或十进制)" Margin="5">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Text="格式: 01 02 03 或 1,2,3 或 010203" 
                                              Foreground="Gray" Margin="5,0,5,5"/>
                                    
                                    <TextBox Grid.Row="1"
                                            Text="{Binding BatchWriteData}" 
                                            AcceptsReturn="True"
                                            TextWrapping="Wrap"
                                            VerticalScrollBarVisibility="Auto"
                                            HorizontalScrollBarVisibility="Disabled"
                                            FontFamily="Consolas"
                                            FontSize="12"/>
                                </Grid>
                            </GroupBox>
                            
                            <Grid Grid.Row="4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Button Content="批量写入" Command="{Binding BatchWriteCommand}" 
                                       Style="{StaticResource ActionButton}"
                                       IsEnabled="{Binding IsConnected}"/>
                                
                                <TextBlock Grid.Column="1" Text="{Binding BatchWriteStatus}" 
                                          VerticalAlignment="Center" Margin="10,0,0,0"
                                          Foreground="{Binding BatchWriteStatusColor}"/>
                            </Grid>
                        </Grid>
                    </GroupBox>
                </Grid>
            </TabItem>
            
            <!-- 批量操作标签页 -->
            <TabItem Header="批量任务">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <ToolBar Grid.Row="0">
                        <Button Content="添加任务" Command="{Binding AddBatchTaskCommand}"/>
                        <Button Content="删除任务" Command="{Binding RemoveBatchTaskCommand}"/>
                        <Separator/>
                        <Button Content="执行所有" Command="{Binding ExecuteBatchCommand}"/>
                        <Button Content="清空结果" Command="{Binding ClearBatchResultsCommand}"/>
                    </ToolBar>
                    
                    <DataGrid Grid.Row="1" ItemsSource="{Binding BatchTasks}" 
                             AutoGenerateColumns="False"
                             CanUserAddRows="True"
                             CanUserDeleteRows="True">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="启用" Binding="{Binding IsEnabled}" Width="50"/>
                            <DataGridComboBoxColumn Header="操作" Width="80">
                                <DataGridComboBoxColumn.ElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="ItemsSource" Value="{Binding DataContext.OperationTypes, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <Setter Property="SelectedItem" Value="{Binding Operation}"/>
                                    </Style>
                                </DataGridComboBoxColumn.ElementStyle>
                            </DataGridComboBoxColumn>
                            <DataGridTextColumn Header="区域" Binding="{Binding Area}" Width="60"/>
                            <DataGridTextColumn Header="DB号" Binding="{Binding DbNumber}" Width="60"/>
                            <DataGridTextColumn Header="地址" Binding="{Binding Address}" Width="80"/>
                            <DataGridTextColumn Header="长度" Binding="{Binding Length}" Width="60"/>
                            <DataGridTextColumn Header="数据" Binding="{Binding Data}" Width="200"/>
                            <DataGridTextColumn Header="结果" Binding="{Binding Result}" Width="*" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>
        
        <!-- 日志区域 -->
        <GroupBox Grid.Row="2" Header="通信日志" Margin="10,0,10,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <ToolBar Grid.Row="0">
                    <Button Content="清空日志" Command="{Binding ClearLogCommand}"/>
                    <CheckBox Content="自动滚动" IsChecked="{Binding AutoScroll}" VerticalAlignment="Center" Margin="10,0"/>
                </ToolBar>
                
                <TextBox Grid.Row="1" Name="txtLog" 
                        Text="{Binding LogText}" 
                        IsReadOnly="True"
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto"
                        HorizontalScrollBarVisibility="Disabled"
                        FontFamily="Consolas"
                        FontSize="11"
                        Background="#F5F5F5"
                        TextChanged="TxtLog_TextChanged"/>
            </Grid>
        </GroupBox>
    </Grid>
</Window>